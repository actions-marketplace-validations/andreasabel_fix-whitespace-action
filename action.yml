name: 'fix-whitespace-action'
description: 'Run fix-whitespace  on your repo'
author: 'Andreas Abel'
inputs:
  version:
    required: true
    description: 'fix-whitespace version'
    default: '0.0.10'

runs:
  using: 'composite'
  steps:

    - name: "Install fix-whitespace"
      shell: bash
      run: |
        # Download binary
        if   [[ ${{ runner.os }} == "Linux"   ]]; then
          EXT="-linux.binary"
        elif [[ ${{ runner.os }} == "macOS"   ]]; then
          EXT="-mac.binary"
        elif [[ ${{ runner.os }} == "Windows" ]]; then
          EXT=".exe"
        endif
        SRC="fix-whitespace-${{ inputs.version }}${EXT}"
        wget "https://github.com/agda/fix-whitespace/releases/download/v${{ inputs.version }}/${SRC}"

        # Put binary as fix-whitespace to ~/.local/bin and put that into the PATH.
        DIR="$HOME/.local/bin"
        chmod +x "${SRC}"
        mkdir -p "${DIR}"
        mv "${SRC}" "${DIR}/fix-whitespace"
        echo "${DIR}" >> "${GITHUB_PATH}"


    - name: "Run fix-whitespace at the root"
      shell: bash
      run: |
        fix-whitespace --check
